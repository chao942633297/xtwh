<include file="Public/head" />

<link rel="stylesheet" type="text/css" href="__PUBLIC__/jedate/skin/jedate.css">
<script type="text/javascript" src="__PUBLIC__/jedate/jquery.jedate.js"></script>
<script src="__PUBLIC__/js/uploadPreview.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/uploadPreview.min.js" type="text/javascript"></script>
 <script>
       window.onload = function () { 
            new uploadPreview({ UpBtn: "up_img", DivShow: "imgdiv", ImgShow: "imgShow" });
        }
    </script>
<style type="text/css">
	table tr > td:first-child{padding-left:20px;padding-bottom:10px;text-align:center;}
	table tr > td:last-child input{width:60%;margin-bottom:10px;	}
ul, ol, dl { list-style: none; }
._citys { width: 450px; display: inline-block; border: 2px solid #eee; padding: 5px; position: relative; background: #fff;}
._citys span { color: #56b4f8; height: 15px; width: 15px; line-height: 15px; text-align: center; border-radius: 3px; position: absolute; right: 10px; top: 10px; border: 1px solid #56b4f8; cursor: pointer; }
._citys0 { width: 100%; height: 34px; display: inline-block; border-bottom: 2px solid #56b4f8; padding: 0; margin: 0; }
._citys0 li { display: inline-block; line-height: 34px; font-size: 15px; color: #888; width: 80px; text-align: center; cursor: pointer; }
.citySel { background-color: #56b4f8; color: #fff !important; }
._citys1 { width: 100%; display: inline-block; padding: 10px 0; }
._citys1 a { width: 83px; height: 35px; display: inline-block; background-color: #f5f5f5; color: #666; margin-left: 6px; margin-top: 3px; line-height: 35px; text-align: center; cursor: pointer; font-size: 13px; overflow: hidden; }
._citys1 a:hover { color: #fff; background-color: #56b4f8; }
.AreaS { background-color: #56b4f8 !important; color: #fff !important; }
</style>
	<div class="modal-header">
      <h4 class="modal-title" id="myModalLabel" style="font-weight: bold;color:red">添 加 机 构　<span>*</span> 为 必 填 项</h4>
    </div>
    <form action="{:U('Mechanism/do_jigou')}" method="post" onSubmit="return check();" enctype="multipart/form-data">
     <div class="modal-body">       
		<table style="width: 100%;">
          <tr style="margin-bottom:5px;">
            <td>合作折扣 <span style="color:red;font-weight: bold">*</span></td></td>
            <td><input type="text" class="form-control" name="rebate" placeholder="合作折扣" id="rebate" value=""></td>
          </tr>     
          <tr style="margin-bottom:5px;">
            <td>机构名称 <span style="color:red;font-weight: bold">*</span></td>
            <td><input type="text" class="form-control" name="title" placeholder="名称" id="name" value=""></td>
          </tr>
          <tr style="margin-bottom:5px;">
            <td>手机号码 <span style="color:red;font-weight: bold">*</span></td>
            <td><input type="text" class="form-control" name="phone" placeholder="手机号码" id="ph" value=""></td>
          </tr>
          <tr style="margin-bottom:5px;">
            <td>主营类别</td>
            <td><input type="text" class="form-control" name="class" placeholder="" id="classname" value="" readonly data-toggle="modal" data-target="#myModal"></td>
          </tr>           
          <tr style="margin-bottom:1px;">
            <td>选择省份/城市</td>
            <td><div ><input type="text" name="city" class="form-control" id="city" />
            </div></td>
          </tr>
           <tr>        
	           <td>详细地址</td>
	           <td><textarea style="resize:none;width:60%;height:50px;margin-top: 10px;" type="text" rows="4" class="form-control" name="address"  ></textarea><font color="red">*街道门牌*</font></td>
	       </tr>  
          <tr style="margin-bottom:5px;">
            <td>封面</td>
            <td id="imgdiv"><input type="file" style="width:100px;" class="form-control" id="up_img" name="photo" ><img id="imgShow" width="100" height="100" /></td>
          </tr>       
	       <tr>        
	           <td>简介</td>
	           <td><textarea style="resize:none;width:60%;height:200px;margin-top: 10px;" type="text" rows="4" class="form-control" name="detail" id="desc" ></textarea><font color="red">*机构的详细介绍*</font></td>
	       </tr>       
		</table>
	    </div>  
	    <input type="hidden" name="type" value="add"> 
	    <input type="hidden" name="class" value="2">  
      <input type="hidden" name="classall" value="" id="classall"> 

		<button class="btn btn-default" type="submit" style="width:200px;text-align:center;margin-top:15px;margin-left:600px;">完成</button>
</form>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">选择类别</h4>
      </div>
      <div class="modal-body">
        <table>
          <volist name="type" id="vo">
              <tr><input type="checkbox" name="" value="{$vo.id}" data="{$vo.name}"><span style="padding-left: 5px;padding-right:10px;padding-top:10px">{$vo.name}</span></tr>
          </volist>  
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="closetype">关闭</button>
        <button type="button" class="btn btn-primary" id="saveType">保存</button>
      </div>
    </div>
  </div>
</div>

<include file="Public/footer" />
<script src="__PUBLIC__/ueditor/ueditor.config.js"></script>
<script src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
<script src="__PUBLIC__/js/jquery-1.11.3.min.js"></script>
<script src="__PUBLIC__/js/Popt.js"></script>
<script src="__PUBLIC__/js/cityJson.js"></script>
<script src="__PUBLIC__/js/citySet.js"></script>
<script type="text/javascript">
  $("#saveType").click(function(){
    var typeid = "" ;
    var typename = "";
    $.each($("input:checkbox:checked"),function(){
      typeid += ","+$(this).val();
      typename += "," +$(this).attr("data");
    }) 
    typeid = typeid.substr(1);
    typename = typename.substr(1);
    $("#classall").val(typeid);
    $("#classname").val(typename);
    $("#closetype").click();
  });

	$("#city").click(function (e) {
		SelCity(this,e);
	    console.log("inout",$(this).val(),new Date())
	});
  $("#rebate").bind("input propertychange",function(){
    var rebate = $(this).val();
    if (!/\d+(\.\d{0,1})?/.test(rebate)) {
      $(this).val("");
    }
  });
	//保存添加或修改的推荐信息
	function check(){
    var name   = $("#name").val();  
    if(name == 0){
      alert('机构名称不能为空');
       return false;
    }
    var pattern = /^1[34578]\d{9}$/;   
    var ph = $("#ph").val();  
    if(ph == 0){
       alert('手机号不能为空');
       return false;
    }
    if(!pattern.test(ph)){
      alert('手机号码格式不对');
      return false;
    }
    var up_img = $("#city").val();
    if(up_img == 0){
      alert('选择地址');
       return false;
    }
    var up_img = $("#up_img").val();
    if(up_img == 0){
      alert('必须上传一张封面');
       return false;
    }
    var price      = $("#desc").val();
    if(price == 0){
      alert('机构介绍不能为空');
       return false;
    }
	  return true; 	
	}

</script>

